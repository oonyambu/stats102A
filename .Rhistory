paste0(substitute(x),".csv")
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- list(gcd = convt2list(tst),
GCD = convt2list(cbind(tst,c(42,30,100,36,77,13,69,18,54,4))))
devtools::load_all(".")
source('D:/Work/school/102A/stats102A/R/grade_Rscripts.R', echo=TRUE)
source('D:/Work/school/102A/stats102A/R/convt2list.R', echo=TRUE)
source('D:/Work/school/102A/stats102A/R/utils.R', echo=TRUE)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst)
tst
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- list(gcd = convt2list(tst),
GCD = convt2list(cbind(tst,c(42,30,100,36,77,13,69,18,54,4))))
tst
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst)
debugonce(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst)
weight
weight
debugonce(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
weight
grade_Rscripts <- function(student_dir,teacher_file,
function_test_data,weight = 1,
keep_par_names = FALSE,
file_name = ""){
source(teacher_file,.teacher)
student_files <- list.files(student_dir,"\\.R$",ignore.case = TRUE,
recursive = TRUE,full.names = TRUE)
functions_to_test <- names(function_test_data)
len_fn <- length(functions_to_test)
nm <- names(weight)
len <- length(weight)
if((len>1&all(nm==""))|(len==1&nm==""))
names(weight) <- functions_to_test
else {
if(len==1)
weight <- setNames(rep(weight,len_fn),functions_to_test)
else
weight[setdiff(functions_to_test, nm)] <- 1
}
.finalize <- function(f){
re <-lapply(student_files,.compare,f,
function_test_data[[f]], weight, keep_par_names)
do.call(rbind.data.frame, c(stringsAsFactors = FALSE, re))
}
result <- do.call(rbind.data.frame,
c(stringsAsFactors = FALSE,
lapply(functions_to_test,.finalize)))
file_write(aggregate(.~ID,result,agg_fun), file_name)
}
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
debugonce(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
debugonce(grade_Rscripts)
debug(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
nm
grade_Rscripts <- function(student_dir,teacher_file,
function_test_data,weight = 1,
keep_par_names = FALSE,
file_name = ""){
source(teacher_file,.teacher)
student_files <- list.files(student_dir,"\\.R$",ignore.case = TRUE,
recursive = TRUE,full.names = TRUE)
functions_to_test <- names(function_test_data)
len_fn <- length(functions_to_test)
nm <- names(weight)
len <- length(weight)
if((len>1&all(is.null(nm)))|(len==1&is.null(nm)))
names(weight) <- functions_to_test
else {
if(len==1)
weight <- setNames(rep(weight,len_fn),functions_to_test)
else
weight[setdiff(functions_to_test, nm)] <- 1
}
.finalize <- function(f){
re <-lapply(student_files,.compare,f,
function_test_data[[f]], weight, keep_par_names)
do.call(rbind.data.frame, c(stringsAsFactors = FALSE, re))
}
result <- do.call(rbind.data.frame,
c(stringsAsFactors = FALSE,
lapply(functions_to_test,.finalize)))
file_write(aggregate(.~ID,result,agg_fun), file_name)
}
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
debug(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
weight
lapply(functions_to_test,.finalize)
functions_to_test
.finalize("gcd")
function_test_data
.compare(student_files[1],function_test_data[["gcd"]])
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
a
a <-"gcd"
.compare(student_files[1],a,function_test_data[[a]])
.compare(student_files[1],a,function_test_data[[a]],weight[a])
weight
weight <- c(gcd = 10,GCD=3)
.compare(student_files[1],a,function_test_data[[a]],weight[a])
lapply(student_files,.compare,a,
function_test_data[[a]], weight, keep_par_names)
re <-lapply(student_files,.compare,a,
function_test_data[[a]], weight, keep_par_names)
do.call(rbind.data.frame, c(stringsAsFactors = FALSE, re))
undebug(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
debug(grade_Rscripts)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
grade_Rscripts <- function(student_dir,teacher_file,
function_test_data,weight = 1,
keep_par_names = FALSE,
file_name = ""){
source(teacher_file,.teacher)
student_files <- list.files(student_dir,"\\.R$",ignore.case = TRUE,
recursive = TRUE,full.names = TRUE)
functions_to_test <- names(function_test_data)
len_fn <- length(functions_to_test)
nm <- names(weight)
len <- length(weight)
if((len>1&all(is.null(nm)))|(len==1&is.null(nm)))
names(weight) <- functions_to_test
else {
if(len==1)
weight <- setNames(rep(weight,len_fn),functions_to_test)
else
weight[setdiff(functions_to_test, nm)] <- 1
}
.finalize <- function(f){
re <-lapply(student_files,.compare,f,
function_test_data[[f]], weight[f], keep_par_names)
do.call(rbind.data.frame, c(stringsAsFactors = FALSE, re))
}
result <- do.call(rbind.data.frame,
c(stringsAsFactors = FALSE,
lapply(functions_to_test,.finalize)))
file_write(aggregate(.~ID,result,agg_fun), file_name)
}
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2))
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(1,2),file_name = NULL)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(10,2),file_name = NULL)
source('D:/Work/school/102A/stats102A/R/utils.R', echo=TRUE)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(10,2),file_name = NULL)
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst,c(10,2))
ls()
list.files()
library(stats102A)
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- list(gcd = convt2list(tst),
GCD = convt2list(cbind(tst,c(42,30,100,36,77,13,69,18,54,4))))
grade_Rscripts("tests/testthat/students/","tests/testthat/987654321_stat102a_test.R",tst)
c(1,s=2)
names(c(1,s=2))
names(c(1,2))
set_name <- function(funs,weights){
len_f <- length(funs)
len_w <- length(weights)
nm <- names(weights)
if(len_w == 1){
if(is.null(nm)) weights <- setNames(rep(weights,len_f),funs)
else weights[setdiff(funs,nm)] <- 1
}
else {
if(is.null(nm)){
if(len_f == len_w)names(weights) <- weights
else stop("unequal length of weights and number of functions")
}
else{
if (any(nm=="")) weights[setdiff(funs, nm)] <- weights[nm==""]
else weights[setdiff(funs, nm)] <- 1
}
}
weights
}
set_name(letters[1:4],c(a=2,b=3))
set_name(letters[1:4],c(2))
set_name(letters[1:4],c(a=2,4))
set_name <- function(funs,weights){
len_f <- length(funs)
len_w <- length(weights)
nm <- names(weights)
if(len_w == 1){
if(is.null(nm)) weights <- setNames(rep(weights,len_f),funs)
else weights[setdiff(funs,nm)] <- 1
}
else {
if(is.null(nm)){
if(len_f == len_w)names(weights) <- weights
else stop("unequal length of weights and number of functions")
}
else{
if (any(nm=="")) weights[setdiff(c(funs,""), nm)] <- weights[nm==""]
else weights[setdiff(funs, nm)] <- 1
}
}
weights
}
set_name(letters[1:4],c(a=2,4))
set_name <- function(funs,weights){
len_f <- length(funs)
len_w <- length(weights)
nm <- names(weights)
if(len_w == 1){
if(is.null(nm)) weights <- setNames(rep(weights,len_f),funs)
else weights[setdiff(funs,nm)] <- 1
}
else {
if(is.null(nm)){
if(len_f == len_w)names(weights) <- weights
else stop("unequal length of weights and number of functions")
}
else{
if (any(nm=="")) weights[setdiff(funs, nm)] <- weights[nm==""]
else weights[setdiff(funs, nm)] <- 1
}
}
weights[names(weights)!=""]
}
set_name(letters[1:4],c(a=2,4))
set_name(letters[1:4],c(a=2))
set_name(letters[1:4],c(2))
set_name(letters[1:4],c(2,3,2,1))
set_name <- function(funs,weights){
len_f <- length(funs)
len_w <- length(weights)
nm <- names(weights)
if(len_w == 1){
if(is.null(nm)) weights <- setNames(rep(weights,len_f),funs)
else weights[setdiff(funs,nm)] <- 1
}
else {
if(is.null(nm)){
if(len_f == len_w)names(weights) <- funs
else stop("unequal length of weights and number of functions")
}
else{
if (any(nm=="")) weights[setdiff(funs, nm)] <- weights[nm==""]
else weights[setdiff(funs, nm)] <- 1
}
}
weights[names(weights)!=""]
}
set_name(letters[1:4],c(2,3,2,1))
set_name(letters[1:4],c(2,3,2))
library(stats102A)
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- list(gcd = convt2list(tst),
GCD = convt2list(cbind(tst,c(42,30,100,36,77,13,69,18,54,4))))
grade_Rscripts("tests/testthat/students/",
"tests/testthat/987654321_stat102a_test.R",tst)
grade_Rscripts("tests/testthat/students/",
"tests/testthat/987654321_stat102a_test.R",tst,c(10,5))
source('D:/Work/school/102A/stats102A/R/utils.R', echo=TRUE)
library(stats102A)
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- data.frame(matrix(c(1071,462,
18678,120,
24,60,
30,24,
98,99,
0,10,
33,121,
432,1452,
462,1452,
-3,5),ncol = 2,byrow=T))
tst <- list(gcd = convt2list(tst),
GCD = convt2list(cbind(tst,c(42,30,100,36,77,13,69,18,54,4))))
grade_Rscripts("tests/testthat/students/",
"tests/testthat/987654321_stat102a_test.R",tst,c(10,5))
library(stats102A)
grade_Rscripts("tests/testthat/students/",
"tests/testthat/987654321_stat102a_test.R",tst,c(10,5))
library(stats102A)
library(stats102A)
