# FIRST Download all the UID students' folders from CCLE to your computer.
# Unzip the downloaded file into a new folder eg ./students

#PLEASE DOWNLOAD THE UID'S AND NOT THE NAMES. IN THAT CASE, WHEN A STUDENT 
#HAS COMPLAINS IT IS EASY FOR ME TO GO BACK TO THEIR WORK

##ENSURE YOU INSTALL THE LATEST version of stats120A package. I UPDATED IT.
# If not, uninstall the one that you have remove.packages("stats102A") then 
#restart the session (Cntr/cmd+shift+F10)and run this script

if(!require(stats102A)) devtools::install_github("oonyambu/stats102A")

students <- "students/"

teacher <- "correct_functions.R"
t_env <- new.env()
source(teacher, t_env)
dat <- list(
messy_impute = list(list(data = t_env$gradebook, margin = 1, center = base::mean),
                     list(data = t_env$gradebook, margin = 1, center = base::mean),
                     list(data = t_env$gradebook, margin = 2, center = stats::median),
                     list(data = t_env$gradebook, margin = 2, center = stats::median)),
tidy_impute = list(list(data = t_env$gradebook_tidy, margin = 1, center = base::mean),
                   list(data = t_env$gradebook_tidy, margin = 1, center = base::mean),
                   list(data = t_env$gradebook_tidy, margin = 2, center = stats::median),
                   list(data = t_env$gradebook_tidy, margin = 2, center = stats::median))

)
a <- list.files(students,"R$",recursive = TRUE,full.names = TRUE)
i<-11
students <- a[i]
grade_Rscripts(students,teacher,dat,rep(10,2),keep_par_names = TRUE,no_match = FALSE,file_name = NULL)

s_env <- new.env()
source(a[i], s_env);i<-i+1
test_function(dat$messy_impute,s_env$messy_impute,t_env$messy_impute)
test_function(dat$tidy_impute,s_env$tidy_impute,t_env$tidy_impute)